{
  "$id": "http://example.com/example.json",
  "type": "object",
  "title": "Clientes",
  "namespace": "facturacion",
  "limit": 40,
  "multiRowAction": true,
  "shareLevel": 5,
  "secure": false,
  "key": "cliente",
  "restricted": ["aprobacionManual", "creditoPlazo", "creditoLimite"],
  "properties": {
    "id": {
      "$id": "/properties/id",
      "type": "integer",
      "title": "Id",
      "locked": true,
      "width": 50
    },
    "activo": {
      "$id": "/properties/activo",
      "type": "boolean",
      "title": "Activo",
      "formatter": "BooleanFormatter",
      "filterable": true,
      "default": true
    },
    "aprobacionManual": {
      "$id": "/properties/aprobacionManual",
      "type": "boolean",
      "title": "AprobacionManual",
      "formatter": "BooleanFormatter",
      "filterable": true,
      "default": true
    },
    "name": {
      "$id": "/properties/name",
      "type": "string",
      "title": "Nombre",
      "width": 300,
      "filterable": true,
      "sortable": true,
      "locked": true
    },
    "tags": {
      "$id": "/properties/roles",
      "type": "string",
      "title": "Tags",
      "element": "multiselect",
      "filterable": true,
      "sortable": true,
      "table": "tag",
      "route": "tag/allWithName",
      "elementOptions": {
        "primary": "name"
      },
      "width": 200
    },
    "cedula": {
      "$id": "/properties/cedula",
      "type": "string",
      "title": "Cédula",
      "minLength": 9,
      "maxLength": 12,
      "pattern": "[0-9]"
    },
    "vencimientoCedula": {
      "$id": "/properties/vencimientoCedula",
      "type": "string",
      "title": "Vencimiento Cedula",
      "width": 150,
      "element": "date",
      "filterRenderer": "DateFilter",
      "filterable": true,
      "editable": true
    },
    "correoDocumentosElectronicos": {
      "$id": "/properties/correoDocumentosElectronicos",
      "type": "string",
      "title": "Email Envio FE",
      "width": 140
    },
    "correoDocumentosElectronicosCC": {
      "$id": "/properties/correoDocumentosElectronicosCC",
      "type": "string",
      "title": "Copias de correo electrónico ",
      "element": "jsonList"
    },
    "distritoId": {
      "$id": "/properties/distritoId",
      "type": "integer",
      "title": "Distrito",
      "table": "distrito",
      "route": "distrito/findLikeName",

      "metadataType": "distrito",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name",
        "secondary": "fullName"
      }
    },
    "tipoCedula": {
      "$id": "/properties/tipoCedula",
      "enum": ["Jurídica", "Física", "DIMEX", "NITE", "Internacional"],
      "type": "string",
      "title": "Tipo Cedula",
      "filterable": true,
      "filterRenderer": "SelectFilter",
      "element": "select"
    },
    "descripcion": {
      "$id": "/properties/descripcion",
      "type": "string",
      "element": "textArea",
      "title": "Descripcion",
      "formatter": "TextFormatter"
    },
    "direccion": {
      "$id": "/properties/direccion",
      "type": "string",
      "subType": "textarea",
      "formatter": "TextFormatter",
      "ui": {
        "fullWidth": true
      },
      "title": "Dirección",
      "default": "San Jose",
      "width": 200
    },
    "telefono": {
      "$id": "/properties/telefono",
      "type": "string",
      "title": "Teléfono",
      "minLength": 9,
      "maxLength": 15
    },
    "sitioWeb": {
      "$id": "/properties/sitioWeb",
      "type": "string",
      "title": "Sitio Web"
    },
    "creditoPlazo": {
      "$id": "/properties/creditoPlazo",
      "type": "integer",
      "title": "Plazo (día)",
      "default": 0,
      "minimum": -1,
      "filterRenderer": "NumericFilter",
      "filterable": true,
      "sortable": true
    },
    "creditoLimite": {
      "$id": "/properties/creditoLimite",
      "type": "number",
      "title": "Límite (₡) ",
      "default": 0,
      "minimum": -1,
      "filterRenderer": "NumericFilter",
      "filterable": true,
      "sortable": true
    },
    "formaEntrega": {
      "$id": "/properties/formaEntrega",
      "type": "string",
      "title": "Forma de entrega"
    },
    "posicionGPS": {
      "$id": "/properties/posicionGPS",
      "type": "string",
      "title": "Posición GPS "
    },
    "ubicacion": {
      "$id": "/properties/ubicaciones",
      "type": "string",
      "title": "Ubicacion"
    },
    "contado": {
      "width": 100,
      "sortable": true,
      "$id": "/properties/contado",
      "type": "string",
      "enum": ["contado", "credito"],
      "title": "Contado",
      "filterable": true,
      "select": "(case when creditoPlazo = 0 then 'contado' else 'credito' end)",
      "filterRenderer": "SelectFilter"
    },
    "cobroDia": {
      "$id": "/properties/cobroDia",
      "enum": ["lunes", "martes", "miercoles", "jueves", "viernes"],
      "type": "string",
      "sortable": true,
      "title": "Dia Cobro",
      "filterable": true,
      "editable": true,
      "filterRenderer": "SelectFilter",
      "element": "select"
    },
    "cobroEncargadoId": {
      "$id": "/properties/cobroEncargadoId",
      "type": "integer",
      "title": "EncargadoCobro",
      "table": "cobroEncargado",
      "filterable": true,
      "metadataType": "cobroEncargado",
      "editable": true,
      "route": "cobroEncargado/findLikeName",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name"
      },
      "width": 150
    },
    "transporteId": {
      "$id": "/properties/transporteId",
      "type": "integer",
      "title": "Transporte",
      "table": "transporte",
      "metadataType": "transporte",
      "filterable": true,
      "route": "transporte/findLikeName",
      "element": "autocomplete",
      "width": 100,
      "elementOptions": {
        "primary": "name"
      }
    },
    "clienteGrupoComercialId": {
      "$id": "/properties/clienteGrupoComercialId",
      "type": "integer",
      "title": "Grupo Comercial",
      "table": "clienteGrupoComercial",
      "metadataType": "clienteGrupoComercia",
      "filterable": true,
      "sortable": true,
      "route": "clienteGrupoComercial/findLikeName",
      "element": "autocomplete",
      "width": 170,
      "elementOptions": {
        "primary": "name"
      }
    },

    "segmentoId": {
      "$id": "/properties/segmentoId",
      "type": "integer",
      "title": "Segmento",
      "table": "segmento",
      "metadataType": "segmento",
      "filterable": true,
      "sortable": true,
      "editable": true,
      "width": 110,
      "route": "segmento/findLikeName",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name"
      }
    },

    "zonaId": {
      "$id": "/properties/zonaId",
      "type": "integer",
      "title": "Zona",
      "table": "zona",
      "metadataType": "zona",
      "filterable": true,
      "route": "zona/findLikeName",
      "element": "autocomplete",
      "width": 100,
      "elementOptions": {
        "primary": "name"
      }
    },

    "ultimoContacto": {
      "$id": "/properties/ultimoContacto",
      "type": "string",
      "title": "Ultimo Contacto",
      "element": "date",
      "formatterer": "DateTimeFormatter",
      "editable": true,
      "filterable": true,
      "filterRenderer": "DateFilter",
      "sortable": true,
      "width": 200
    },

    "plazoPago": {
      "$id": "/properties/plazoPago",
      "type": "number",
      "title": "Promedio(días)",
      "filterable": true,
      "sortable": true,
      "width": 100
    },

    "plazoMaximo": {
      "$id": "/properties/plazoMaximo",
      "type": "number",
      "title": "Plazo Maximo",
      "filterable": true,
      "sortable": true,
      "width": 200
    },

    "ultimaCompra": {
      "$id": "/properties/ultimaCompra",
      "type": "number",
      "title": "Ultima Compra",
      "filterable": true,
      "sortable": true,
      "width": 200,
      "filterRenderer": "NumericFilter"
    },

    "createdBy": {
      "$id": "/properties/createdBy",
      "type": "string",
      "title": "Creado por"
    },
    "updatedBy": {
      "$id": "/properties/updatedBy",
      "type": "string",
      "title": "Actualizado por"
    },
    "createdAt": {
      "$id": "/properties/createdAt",
      "type": "string",
      "title": "Creado"
    },
    "updatedAt": {
      "$id": "/properties/updatedAt",
      "type": "string",
      "title": "Actualizado"
    },
    "ownerId": {
      "$id": "/properties/ownerId",
      "type": "integer",
      "title": "Propietario",
      "table": "owner",
      "filterable": true,
      "sortable": true,
      "route": "owner/findLikeName",
      "metadataType": "owner",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name"
      },
      "width": 135
    }
  },
  "required": ["name"],
  "belongsTo": ["zona", "transporte", "owner", "segmento", "clienteGrupoComercial","cobroEncargado"],
  "actions": ["Crear", "Editar", "Ver"],
  "view": {
    "fields": ["name", "ownerId", "telefono", "direccion", "zonaId"],
    "fullFields": [],
    "metrics": [
      {
        "key": "ultimaCompra",
        "title": "Ultima Compra",
        "type": "METRIC",
        "table": "clienteStats",
        "statKey": "ultimaCompra",
        "filters": [["clienteStats.clienteId", "=", "$"]]
      },

      {
        "key": "ventasPeriodo",
        "title": "Ventas Ciclo",
        "type": "STAT",
        "statKey": "documento.totalVentaNeta",
        "table": "documento",
        "symbol": "(₡)",
        "filters": [["documento.clienteId", "=", "$"], ["documento.fecha", "FIXED", "CICLO"]],
        "helpText": "Cobertura de ventas al día",
        "groupBy": {
          "sumFields": "documento.totalVentaNeta",
          "groupBy": ["documento.clienteId"]
        }
      },
      {
        "key": "lineaPagoDocumento",
        "title": "Pagos por Aplicar",
        "type": "METRIC",
        "table": "lineaPagoDocumento",
        "filters": [["pagoDocumento.clienteId", "=", "$"], ["lineaPagoDocumento.montoPendiente", "!=", 0]],
        "groupBy": {
          "sumFields": "lineaPagoDocumento.montoPendiente",
          "groupBy": ["pagoDocumento.clienteId"]
        }
      },

      {
        "key": "promedioCompra",
        "title": "Promedio Compra",
        "type": "STAT",
        "table": "clienteStats",
        "statKey": "clienteStats.promedioCompra",
        "symbol": "(₡)",
        "helpText": "Promedio mensual, ultimas 12 semanas",
        "filters": [["clienteStats.clienteId", "=", "$"]],
        "groupBy": {
          "sumFields": "clienteStats.promedioCompra",
          "groupBy": ["clienteStats.clienteId"]
        }
      },
      {
        "key": "nivelG1",
        "title": "Nivel 6013",
        "type": "STAT",
        "symbol": "(Programa)",
        "sufix": "KG",
        "table": "clienteStats",
        "helpText": "El nivel del Programa Hilco",
        "statKey": "totalCicloUnidadG1",
        "filters": [["clienteStats.clienteId", "=", "$"]]
      },
      {
        "key": "saldoVencido",
        "title": "Saldo Vencido",
        "type": "METRIC",
        "table": "saldo",
        "filters": [["documento.clienteId", "=", "$"], ["plazoVencido", ">=", 15], ["saldo.total", "!=", 0]],
        "groupBy": {
          "sumFields": "total",
          "groupBy": ["documento.clienteId"]
        }
      },

      {
        "key": "saldo",
        "title": "Saldo",
        "type": "STAT",
        "statKey": "total",
        "symbol": "(₡)",

        "helpText": "Saldo total del cliente",
        "table": "saldo",
        "filters": [["documento.clienteId", "=", "$"], ["saldo.total", "!=", 0]],
        "groupBy": {
          "sumFields": "total",
          "groupBy": ["documento.clienteId"]
        }
      },

      {
        "key": "coberturaCredito1",
        "title": "Utilización Credito",
        "type": "STAT",
        "goal": 200,
        "sufix": "%",
        "symbol": "(₡)",
        "table": "clienteStats",
        "helpText": "Como esta utilizando el credito en colones",
        "statKey": "coberturaCreditoMonto",
        "filters": [["clienteStats.clienteId", "=", "$"]]
      },

      {
        "key": "coberturaCredito2",
        "title": "Utilización Credito",
        "type": "STAT",
        "goal": 200,
        "sufix": "%",
        "symbol": "(dias)",
        "table": "clienteStats",
        "helpText": "Como esta utilizando el credito en días",
        "statKey": "coberturaCreditoDias",
        "filters": [["clienteStats.clienteId", "=", "$"]]
      },

      {
        "key": "promedioPagoDias",
        "title": "Promedio Pago (días)",
        "type": "STAT",
        "table": "clienteStats",
        "symbol": "(dias)",

        "helpText": "Como esta utilizando el credito en días",
        "statKey": "clienteStats.promedioPagoDias",
        "filters": [["clienteStats.clienteId", "=", "$"]],
        "groupBy": {
          "sumFields": "clienteStats.promedioPagoDias",
          "groupBy": ["clienteStats.clienteId"]
        }
      },

      {
        "key": "saldo1",
        "title": "Saldos Vencidos",
        "type": "BAR",
        "table": "saldo",
        "filters": [["documento.clienteId", "=", "$"], ["saldo.total", "!=", 0]],
        "groupBy": {
          "sumFields": "total",
          "groupBy": ["plazoVencidoAgrupado"]
        }
      }
    ],

    "individualFields": [
      {
        "route": "cliente/queProductosCompra",
        "key": "movimientoInventario",
        "title": "Productos",
        "table": "movimientoInventario",
        "fields": ["name", "ultimaCompra", "cantidad", "precio", "descuento", "tipo"],
        "filters": [["movimientoInventario.clienteId", "=", "$"]],
        "params": { "limit": 100 }
      }
    ],

    "relatedFields": [
      {
        "route": "saldo/query",
        "key": "saldos",
        "title": "Saldos",
        "table": "saldo",
        "fields": ["id", "consecutivo", "plazoAgrupado", "plazoActual", "plazo", "total"],
        "filters": [["documento.clienteId", "=", "$"], ["saldo.total", "!=", 0]],
        "params": { "order": "plazoActual" }
      },

      {
        "route": "documento/query",
        "key": "documentos",
        "title": "Facturas",
        "table": "documento",
        "fields": ["id", "consecutivo", "fecha", "totalComprobante"],
        "filters": [
          ["documento.clienteId", "=", "$"],
          ["documento.tipo", "=", "FA"],
          ["documento.fecha", "FIXED", "12 SEMANAS"]
        ],
        "params": { "order": "documento.fecha" }
      },

      {
        "route": "lineaPagoDocumento/query",
        "key": "lineaPagoDocumento",
        "title": "Pagos Pendientes",
        "table": "lineaPagoDocumento",
        "fields": ["id", "consecutivo", "fecha", "plazo", "montoPendiente"],
        "filters": [["pagoDocumento.clienteId", "=", "$"], ["lineaPagoDocumento.montoPendiente", "!=", 0]]
      },
      {
        "route": "lineaPagoDocumento/query",
        "key": "lineaPagoDocumento",
        "title": "Pagos Aplicados",
        "table": "lineaPagoDocumento",
        "fields": ["id", "consecutivo", "fecha", "plazo", "monto"],
        "filters": [
          ["pagoDocumento.clienteId", "=", "$"],
          ["pagoDocumento.fecha", "FIXED", "12 SEMANAS"],
          ["lineaPagoDocumento.monto", "!=", 0]
        ],
        "params": { "limit": 40 }
      },
      {
        "route": "orden/query",
        "key": "orden",
        "title": "Otras Ordenes",
        "table": "orden",
        "fields": ["id", "fecha", "estado", "total"],
        "filters": [["orden.clienteId", "=", "$"], ["orden.estado", "!=", "archivado"]],
        "params": { "limit": 20 }
      }
    ]
  },
  "layout": [
    {
      "title": "Información",
      "cols": 4,
      "fields": ["name", "ownerId", "clienteGrupoComercialId", "cedula", "vencimientoCedula"]
    },
    {
      "title": "Legal",
      "cols": 4,
      "fields": ["direccion", "correoDocumentosElectronicos", "telefono", "correoDocumentosElectronicosCC"]
    },
    {
      "title": "credito",
      "cols": 4,
      "fields": ["creditoPlazo", "creditoLimite", "activo", "aprobacionManual", "cobroDia", "cobroEncargadoId"]
    },
    {
      "title": "ventas",
      "cols": 4,
      "fields": ["tipoCedula", "transporteId", "zonaId", "distritoId"]
    },

    {
      "title": "mercadeo",
      "cols": 8,
      "fieldSize": 6,
      "fields": ["tags", "segmentoId"]
    },

    {
      "title": "otros",
      "cols": 8,
      "fieldSize": 6,
      "fields": ["posicionGPS", "formaEntrega"]
    }
  ],
  "table": {
    "sum": [],
    "fields": [
      "id",
      "name",
      "clienteGrupoComercialId",
      "zonaId",
      "creditoPlazo",
      "creditoLimite",
      "cedula",
      "vencimientoCedula",
      "ownerId",
      "correoDocumentosElectronicos",
      "telefono",
      "transporteId",
      "segmentoId",
      "activo",
      "direccion",
      "tags",
      "contado",
      "cobroDia",
      "cobroEncargadoId"
    ]
  },
  "batch": ["zonaId", "activo"],
  "tableOverride": {
    "mercadeo": {
      "fields": [
        "id",
        "name",
        "zonaId",
        "contado",
        "plazoMaximo",
        "ultimoContacto",
        "promedioCompra",
        "ultimaCompra",
        "ownerId",
        "telefono",
        "distritoId",
        "tags"
      ]
    }
  }
}
