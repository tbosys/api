{
  "$id": "http://example.com/example.json",
  "type": "object",
  "title": "Clientes",
  "aliasFor": "clienteStats",
  "namespace": "facturacion",
  "limit": 20,
  "multiRowAction": true,
  "shareLevel": 5,
  "secure": false,
  "key": "clienteStats",
  "restricted": ["aprobacionManual", "creditoPlazo", "creditoLimite"],
  "properties": {
    "id": {
      "$id": "/properties/id",
      "type": "integer",
      "title": "Id",
      "locked": true,
      "width": 50
    },
    "clienteId": {
      "$id": "/properties/clienteId",
      "type": "integer",
      "title": "Cliente",
      "table": "cliente",
      "metadataType": "cliente",
      "filterable": true,

      "width": 250,
      "route": "cliente/findLikeName",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name"
      },
      "locked": true
    },
    "name": {
      "$id": "/properties/name",
      "type": "string",
      "title": "Nombre",
      "width": 300,
      "filterable": true,
      "sortable": true,
      "locked": true
    },
    "tags": {
      "$id": "/properties/tags",
      "type": "string",
      "title": "Tags",
      "element": "multiselect",
      "table": "tag",
      "sortable": true,
      "filterable": true,
      "route": "tag/allWithName",
      "elementOptions": {
        "primary": "name"
      },
      "width": 200
    },

    "distritoId": {
      "$id": "/properties/distritoId",
      "type": "integer",
      "title": "Distrito",
      "table": "distrito",
      "route": "distrito/findLikeName",

      "metadataType": "distrito",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name",
        "secondary": "fullName"
      }
    },

    "creditoPlazo": {
      "$id": "/properties/creditoPlazo",
      "type": "integer",
      "title": "Plazo (día)",
      "default": 0,
      "minimum": -1,
      "filterRenderer": "NumericFilter",
      "filterable": true,
      "sortable": true
    },
    "creditoLimite": {
      "$id": "/properties/creditoLimite",
      "type": "number",
      "title": "Límite (₡) ",
      "default": 0,
      "minimum": -1,
      "filterRenderer": "NumericFilter",
      "filterable": true,
      "sortable": true
    },

    "saldo": {
      "$id": "/properties/saldo",
      "type": "number",
      "title": "Saldo (₡) ",
      "default": 0,
      "filterRenderer": "NumericFilter",
      "filterable": true,
      "sortable": true
    },

    "segmentoId": {
      "$id": "/properties/segmentoId",
      "type": "integer",
      "title": "Segmento",
      "table": "segmento",
      "metadataType": "segmento",
      "filterable": true,
      "sortable": true,
      "editable": true,
      "width": 110,
      "route": "segmento/findLikeName",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name"
      }
    },

    "zonaId": {
      "$id": "/properties/zonaId",
      "type": "integer",
      "title": "Zona",
      "table": "zona",
      "metadataType": "zona",
      "filterable": true,
      "route": "zona/findLikeName",
      "element": "autocomplete",
      "width": 100,
      "elementOptions": {
        "primary": "name"
      }
    },

    "ultimoContacto": {
      "$id": "/properties/ultimoContacto",
      "type": "string",
      "title": "Ultimo Contacto",
      "element": "date",
      "formatterer": "DateTimeFormatter",
      "editable": true,
      "filterable": true,
      "filterRenderer": "DateFilter",
      "sortable": true,
      "width": 200
    },
    "ultimaCompra": {
      "$id": "/properties/ultimaCompra",
      "type": "string",
      "title": "Ultima Compra",
      "element": "date",
      "formatterer": "DateTimeFormatter",

      "filterable": true,
      "filterRenderer": "DateFilter",
      "sortable": true,
      "width": 120
    },

    "promedioCompra": {
      "$id": "/properties/plazoMaximo",
      "type": "number",
      "title": "Ventas (~C/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCiclo": {
      "$id": "/properties/totalCiclo",
      "type": "number",
      "title": "Ventas (ΣC/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },

    "promedioCompraG1": {
      "$id": "/properties/promedioCompraG1",
      "type": "number",
      "title": "6013 (~C/)",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },

    "coberturaCompra": {
      "$id": "/properties/coberturaCompraG1",
      "type": "number",
      "title": "Ventas {%}",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCompraG1": {
      "$id": "/properties/coberturaCompraG1",
      "type": "number",
      "title": "6013 {%}",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCompraG2": {
      "$id": "/properties/coberturaCompraG2",
      "type": "number",
      "title": "Yale {%}",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCompraG3": {
      "$id": "/properties/coberturaCompraG3",
      "type": "number",
      "title": "Delko {%}",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCompraG4": {
      "$id": "/properties/coberturaCompraG4",
      "type": "number",
      "title": "Coflex {%}",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },
    "coberturaCompraG5": {
      "$id": "/properties/coberturaCompraG4",
      "type": "number",
      "title": "HilcoA {%}",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCompraGs": {
      "$id": "/properties/coberturaCompraGs",
      "type": "number",
      "title": "Marcas {%}",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCreditoMonto": {
      "$id": "/properties/coberturaCreditoMonto",
      "type": "number",
      "title": "Credito C/{%}",
      "filterable": true,

      "sortable": true,
      "width": 140,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "coberturaCreditoDias": {
      "$id": "/properties/coberturaCreditoDias",
      "type": "number",
      "title": "Credito Días {%}",
      "filterable": true,

      "sortable": true,
      "width": 120,
      "filterRenderer": "NumericFilter",
      "formatter": "PercentFormatter"
    },

    "totalCicloG1": {
      "$id": "/properties/totalCicloG1",
      "type": "number",
      "title": "6013 (ΣC/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCicloG2": {
      "$id": "/properties/totalCicloG2",
      "type": "number",
      "title": "Yale (ΣC/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCicloUnidadG1": {
      "$id": "/properties/totalCicloUnidadG1",
      "type": "number",
      "title": "6013 (ΣUnid)",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCicloUnidadG2": {
      "$id": "/properties/totalCicloUnidadG2",
      "type": "number",
      "title": "Yale (ΣUnid)",
      "filterable": true,

      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCicloUnidadG3": {
      "$id": "/properties/totalCicloUnidadG3",
      "type": "number",
      "title": "Delko (ΣUnid)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCicloUnidadG4": {
      "$id": "/properties/totalCicloUnidadG4",
      "type": "number",
      "title": "Coflex (ΣUnid)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "totalCicloUnidadG5": {
      "$id": "/properties/totalCicloUnidadG5",
      "type": "number",
      "title": "HilcoA (ΣUnid)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },

    "promedioCompraG2": {
      "$id": "/properties/promedioCompraG2",
      "type": "number",
      "title": "Yale (~C/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "promedioCompraG3": {
      "$id": "/properties/promedioCompraG3",
      "type": "number",
      "title": "Delko (~C/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "promedioCompraG4": {
      "$id": "/properties/promedioCompraG4",
      "type": "number",
      "title": "Coflex (~C/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "promedioCompraG5": {
      "$id": "/properties/promedioCompraG5",
      "type": "number",
      "title": "HilcoA (~C/)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "promedioPagoDias": {
      "$id": "/properties/promedioPagoDias",
      "type": "number",
      "title": "Pago (~días)",
      "filterable": true,
      "sortable": true,
      "width": 100,
      "filterRenderer": "NumericFilter"
    },
    "clienteGrupoComercialId": {
      "$id": "/properties/clienteGrupoComercialId",
      "type": "integer",
      "title": "Grupo Comercial",
      "table": "clienteGrupoComercial",
      "metadataType": "clienteGrupoComercia",
      "filterable": true,
      "sortable": true,
      "editable": false,
      "route": "clienteGrupoComercial/findLikeName",
      "element": "autocomplete",
      "width": 140,
      "elementOptions": {
        "primary": "name"
      }
    },
    "ownerId": {
      "$id": "/properties/ownerId",
      "type": "integer",
      "title": "Propietario",
      "table": "owner",
      "filterable": true,
      "sortable": true,
      "route": "owner/findLikeName",
      "metadataType": "owner",
      "element": "autocomplete",
      "elementOptions": {
        "primary": "name"
      },
      "width": 135
    }
  },
  "required": ["name"],
  "belongsTo": ["zona", "owner", "segmento", "cliente", "clienteGrupoComercial"],
  "actions": ["Ver"],
  "view": {
    "fields": ["name"],
    "fullFields": [],
    "metrics": [],
    "relatedFields": [
      {
        "route": "saldo/query",
        "key": "saldos",
        "title": "Saldos",
        "table": "saldo",
        "fields": ["id", "consecutivo", "plazoAgrupado", "plazoActual", "plazo", "total"],
        "filters": [["documento.clienteId", "=", "$clienteId"], ["saldo.total", "!=", 0]],
        "params": { "order": "plazoActual" }
      },
      {
        "route": "contacto/query",
        "key": "contactos",
        "title": "Contactos",
        "table": "contacto",
        "fields": ["id", "name", "rol", "email"],
        "filters": [["contacto.clienteId", "=", "$clienteId"]],
        "params": {},
        "actions": ["Crear"]
      },
      {
        "route": "documento/query",
        "key": "documentos",
        "title": "Facturas",
        "table": "documento",
        "fields": ["id", "consecutivo", "fecha", "totalComprobante"],
        "filters": [["documento.clienteId", "=", "$clienteId"], ["documento.tipo", "=", "FA"]],
        "params": { "limit": 20 }
      },
      {
        "route": "movimientoInventario/query",
        "key": "movimientoInventario",
        "title": "Productos",
        "table": "documento",
        "fields": [
          "id",
          "__productoId",
          "tipo",
          "cantidad",
          "fecha",
          "precio",
          "descuentoUnitario",
          "anulacion"
        ],
        "filters": [["documento.clienteId", "=", "$clienteId"], ["documento.tipo", "=", "FA"]],
        "params": { "limit": 40 }
      },
      {
        "route": "lineaPagoDocumento/query",
        "key": "lineaPagoDocumento",
        "title": "Pagos Pendientes",
        "table": "lineaPagoDocumento",
        "fields": ["id", "consecutivo", "fecha", "plazo", "montoPendiente"],
        "filters": [
          ["documento.clienteId", "=", "$clienteId"],
          ["lineaPagoDocumento.montoPendiente", "!=", 0]
        ]
      },
      {
        "route": "lineaPagoDocumento/query",
        "key": "lineaPagoDocumento",
        "title": "Pagos Aplicados",
        "table": "lineaPagoDocumento",
        "fields": ["id", "consecutivo", "fecha", "plazo", "monto"],
        "filters": [
          ["documento.clienteId", "=", "$clienteId"],
          ["lineaPagoDocumento.montoPendiente", "=", 0]
        ],
        "params": { "limit": 40 }
      },
      {
        "route": "orden/query",
        "key": "orden",
        "title": "Otras Ordenes",
        "table": "orden",
        "fields": ["id", "fecha", "estado", "total"],
        "filters": [["orden.clienteId", "=", "$clienteId"], ["orden.estado", "!=", "archivado"]],
        "params": { "limit": 20 }
      }
    ]
  },
  "layout": [],

  "table": {
    "sum": ["promedioCompra"],
    "fields": [
      "id",
      "clienteId",
      "clienteGrupoComercialId",
      "ultimaCompra",
      "promedioPagoDias",
      "promedioCompra",
      "totalCiclo",
      "coberturaCompra",
      "totalCicloUnidadG1",
      "totalCicloG1",
      "promedioCompraG1",
      "coberturaCompraG1",
      "zonaId",
      "ownerId",
      "segmentoId",
      "coberturaCompraGs",
      "promedioCompraG2",
      "promedioCompraG3",
      "promedioCompraG4",
      "promedioCompraG5",
      "coberturaCreditoMonto",
      "coberturaCreditoDias",
      "creditoPlazo",
      "creditoLimite",
      "saldo",

      "distritoId",

      "tags"
    ]
  }
}
